/*! front.js 2018-06-12 */

function del(n,t){return dialog.confirm(t,function(){location.href=$(n).attr("href")}),!1}function callfunc(n,t,i,o){if(i){"string"==typeof i&&(i=i.split(","));var a=i.indexOf("###");0<=a?i[a]=n:i=[n].concat(i)}else i=[n];return window[t]?window[t].apply(o,i):n}function iif(n,t,i){return"0"===n&&(n=0),n?t:i}Number.prototype.format=function(n){void 0===n&&(n=2);for(var t=this.toFixed(n).split("."),i=[],o=t[0].split(""),a=o.length,e=0;e<a;e++)0<e&&e%3==0&&i.unshift(","),i.unshift(o[a-e-1]);return i.join("")+(2==t.length?"."+t[1]:"")},String.prototype.compile=function(l,n){if(n){var t=[];for(var i in l)t.push(this.compile(l[i]));return t.join("\n")}return this.replace(/\{@([\w\d\.]+)(?:\|([\w\d]+)(?:\s*=\s*([\w\d,\s#]+))?)?\}/g,function(n,t,i,o){if(0<t.indexOf(".")){for(var a=t.split("."),e=l,s=0;s<a.length;s++){if(!e[a[s]]){e="";break}e=e[a[s]]}return callfunc(e,i,o)}return l[t]?callfunc(l[t],i,o,l):""})};var dialogTpl='<div class="modal fade" id="{@id}" tabindex="-1" role="dialog" aria-labelledby="{@id}Label" aria-hidden="true">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title" id="{@id}Label"></h4>\n                <button type="button" class="close" data-dismiss="modal">\n                    <span aria-hidden="true">&times;</span>\n                    <span class="sr-only">Close</span>\n                </button>\n            </div>\n            <div class="modal-body">\n            </div>\n            <div class="modal-footer">\n                <nav class="nav nav-fill"></nav>\n            </div>\n        </div>\n    </div>\n</div>',dialogIdx=0;function Dialog(n){if(n||(n={}),void 0!==n.btns){"string"==typeof n.btns&&(n.btns=[n.btns]);for(var t=-1,i=0;i<n.btns.length;i++)"string"==typeof n.btns[i]&&(n.btns[i]={text:n.btns[i]}),n.btns[i].isdefault&&(t=i);t<0&&(t=n.btns.length-1,n.btns[t].isdefault=!0),n.btns[t].type||(n.btns[t].type="primary"),n.defaultBtn=t}this.options=$.extend({id:"dlgModal"+dialogIdx++,size:"",btns:[{text:"取消",type:"secondary"},{text:"确定",isdefault:!0,type:"primary"}],defaultBtn:1,onsure:null,onshow:null,onshown:null,onhide:null,onhidden:null},n),this.box=$(this.options.id)}Dialog.prototype.generBtn=function(n,t){return n.type&&(n.class="btn-outline-"+n.type),'<a href="javascript:" class="nav-item btn '+(n.class?n.class:"btn-outline-secondary")+'" data-index="'+t+'">'+n.text+"</a>"},Dialog.prototype.show=function(n,t){this.box=$("#"+this.options.id),t||(t="系统提示"),this.box.length<1?($(document.body).append(dialogTpl.compile({id:this.options.id})),this.box=$("#"+this.options.id)):this.box.unbind();var i=this;Dialog.instance=i;for(var o=[],a=0;a<this.options.btns.length;a++)o.push(this.generBtn(this.options.btns[a],a));this.box.find(".modal-footer .nav").html(o.join("\n"));var e=this.box.find(".modal-dialog");e.removeClass("modal-sm").removeClass("modal-lg"),"sm"==this.options.size?e.addClass("modal-sm"):"lg"==this.options.size&&e.addClass("modal-lg"),this.box.find(".modal-title").text(t);var s=this.box.find(".modal-body");return s.html(n),this.box.on("hide.bs.modal",function(){i.options.onhide&&i.options.onhide(s,i.box),Dialog.instance=null}),this.box.on("hidden.bs.modal",function(){i.options.onhidden&&i.options.onhidden(s,i.box),i.box.remove()}),this.box.on("show.bs.modal",function(){i.options.onshow&&i.options.onshow(s,i.box)}),this.box.on("shown.bs.modal",function(){i.options.onshown&&i.options.onshown(s,i.box)}),this.box.find(".modal-footer .btn").click(function(){var n=!0,t=$(this).data("index");i.options.btns[t].click&&(n=i.options.btns[t].click.apply(this,[s,i.box])),t==i.options.defaultBtn&&i.options.onsure&&(n=i.options.onsure.apply(this,[s,i.box])),!1!==n&&i.box.modal("hide")}),this.box.modal("show"),this},Dialog.prototype.hide=function(){return this.box.modal("hide"),this};var dialog={alert:function(n,t,i){var o=!1,a="function"==typeof t;return new Dialog({btns:"确定",onsure:function(){if(a)return t(o=!0)},onhide:function(){!o&&a&&t(!1)}}).show(n,i)},confirm:function(n,t,i){return new Dialog({onsure:function(){if("function"==typeof t)return!0,t()},onhide:function(){if(!1)return i()}}).show(n)},prompt:function(n,o,t){return new Dialog({onshown:function(n){n.find("[name=confirm_input]").focus()},onsure:function(n){var t=n.find("[name=confirm_input]").val();if("function"==typeof o){var i=o(t);return!0===i&&!0,i}},onhide:function(){if(!1)return t()}}).show('<input type="text" name="confirm_input" class="form-control" />',n)},pickUser:function(e,t,s){var l=null;s||(s={});new Dialog({onshown:function(n){var t=n.find(".searchbtn"),i=n.find(".searchtext"),o=n.find(".list-group"),a=!1;t.click(function(){a||(a=!0,o.html('<span class="list-loading">加载中...</span>'),s.key=i.val(),$.ajax({url:e,type:"GET",dataType:"JSON",data:s,success:function(i){a=!1,i.status?i.data&&i.data.length?(o.html('<a href="javascript:" data-id="{@id}" class="list-group-item list-group-item-action">[{@id}]&nbsp;<i class="ion-md-person"></i> {@username}&nbsp;&nbsp;&nbsp;<small><i class="ion-md-phone-portrait"></i> {@mobile}</small></a>'.compile(i.data,!0)),o.find("a.list-group-item").click(function(){for(var n=$(this).data("id"),t=0;t<i.data.length;t++)if(i.data[t].id==n){l=i.data[t],o.find("a.list-group-item").removeClass("active"),$(this).addClass("active");break}})):o.html('<span class="list-loading"><i class="ion-md-warning"></i> 没有检索到会员</span>'):o.html('<span class="text-danger"><i class="ion-md-warning"></i> 加载失败</span>')}}))}).trigger("click")},onsure:function(n){return l?"function"==typeof t?t(l):void 0:(toastr.warning("没有选择会员!"),!1)}}).show('<div class="input-group"><input type="text" class="form-control searchtext" name="keyword" placeholder="根据会员id或名称，电话来搜索"/><div class="input-group-append"><a class="btn btn-outline-secondary searchbtn"><i class="ion-md-search"></i></a></div></div><div class="list-group mt-2"></div>',"请搜索并选择会员")},pickLocate:function(n,t,s){var l=null;new Dialog({size:"lg",onshown:function(n){var t=n.find(".searchbtn"),i=n.find(".searchtext"),o=n.find(".map"),a=n.find(".mapinfo");o.css("height",.6*$(window).height());var e=InitMap("tencent",o,function(n,t){a.html(n+"&nbsp;"+t.lng+","+t.lat),l=t},s);t.click(function(){var n=i.val();e.setLocate(n)})},onsure:function(n){return l?"function"==typeof t?t(l):void 0:(toastr.warning("没有选择位置!"),!1)}}).show('<div class="input-group"><input type="text" class="form-control searchtext" name="keyword" placeholder="填写地址检索位置"/><div class="input-group-append"><a class="btn btn-outline-secondary searchbtn"><i class="ion-md-search"></i></a></div></div><div class="map mt-2"></div><div class="mapinfo mt-2 text-muted">未选择位置</div>',"请选择地图位置")}};if(jQuery(function(n){n(document).on("keydown",function(n){if(Dialog.instance){var t=Dialog.instance;13==n.keyCode&&t.box.find(".modal-footer .btn").eq(t.options.defaultBtn).trigger("click")}})}),jQuery.extend(jQuery.fn,{tags:function(n){var o=[],a='<span class="badge badge-info">{@label}<input type="hidden" name="'+n+'" value="{@label}"/><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></span>',t=$(this).parents(".form-control"),e=$('<span class="badge-group"></span>'),s=this;this.before(e),this.on("keyup",function(){var n=$(this).val().replace(/，/g,",");if(n&&-1<n.indexOf(",")){for(var t=n.split(","),i=0;i<t.length;i++)t[i]=t[i].replace(/^\s|\s$/g,""),t[i]&&-1===o.indexOf(t[i])&&(o.push(t[i]),e.append(a.compile({label:t[i]})));s.val("")}}).on("blur",function(){$(this).val($(this).val()+",").trigger("keyup")}).trigger("keyup"),e.on("click",".close",function(){var n=$(this).parents(".badge").find("input").val(),t=o.indexOf(n);t&&o.splice(t,1),$(this).parents(".badge").remove()}),t.click(function(){s.focus()})}}),$.fn.datetimepicker){var tooltips={today:"定位当前日期",clear:"清除已选日期",close:"关闭选择器",selectMonth:"选择月份",prevMonth:"上个月",nextMonth:"下个月",selectYear:"选择年份",prevYear:"上一年",nextYear:"下一年",selectDecade:"选择年份区间",prevDecade:"上一区间",nextDecade:"下一区间",prevCentury:"上个世纪",nextCentury:"下个世纪"},icons={time:"ion-md-time",date:"ion-md-calendar",up:"ion-md-arrow-dropup",down:"ion-md-arrow-dropdown",previous:"ion-md-arrow-dropleft",next:"ion-md-arrow-dropright",today:"ion-md-today",clear:"ion-md-trash",close:"ion-md-close"};$(".datepicker").datetimepicker({icons:icons,tooltips:tooltips,format:"YYYY-MM-DD",locale:"zh-cn",showClear:!0,showTodayButton:!0,showClose:!0,keepInvalid:!0}),$(".date-range").each(function(){var n=$(this).find("[name=fromdate],.fromdate"),t=$(this).find("[name=todate],.todate"),i={icons:icons,tooltips:tooltips,format:"YYYY-MM-DD",locale:"zh-cn",showClear:!0,showTodayButton:!0,showClose:!0,keepInvalid:!0};n.datetimepicker(i).on("dp.change",function(){n.val()&&t.data("DateTimePicker").minDate(n.val())}),t.datetimepicker(i).on("dp.change",function(){t.val()&&n.data("DateTimePicker").maxDate(t.val())})})}jQuery(function(n){});